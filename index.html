<head>
<meta charset="utf-8"/>

<style>
body {
    margin: 0;
        padding: 0;

}
</style>
</head>

<body>

<audio id="soundz" src="radioaudio.mp3" autoplay></audio>
<audio id="soundz2" src="untitled.wav" autoplay></audio>
<canvas id="visualizer"></canvas>
<div style="display:none;">
  <img id="lcd_tux" src="lcd_tux.jpg"
       width="200" height="200">
</div>


    <script>
var audioCtx = new (window.AudioContext || window.webkitAudioContext)();



var analyser = audioCtx.createAnalyser();

var audioElement = document.getElementById("soundz");
var source = audioCtx.createMediaElementSource(audioElement);
source.connect(analyser);
analyser.connect(audioCtx.destination);

analyser.fftSize = 2048;
var bufferLength = analyser.frequencyBinCount;
var dataArray = new Float32Array(bufferLength);



var analyser2 = audioCtx.createAnalyser();

var audioElement2 = document.getElementById("soundz2");
var source2 = audioCtx.createMediaElementSource(audioElement2);
source2.connect(analyser2);
analyser2.connect(audioCtx.destination);

analyser2.fftSize = 2048;
var bufferLength2 = analyser.frequencyBinCount;
var dataArray2 = new Float32Array(bufferLength2);





var canvas = document.getElementById("visualizer");
var canvasCtx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

var WIDTH = canvas.width;
var HEIGHT = canvas.height;
canvasCtx.clearRect(0, 0, WIDTH, HEIGHT);

var smoothedVol = 0;
var scaledVol = 0;

// From http://rosettacode.org/wiki/Map_range#JavaScript
var mapRange = function(from, to, s) {
    return to[0] + (s - from[0]) * (to[1] - to[0]) / (from[1] - from[0]);
};

function drawVisualizer(x, y, width, height, colour, dataArray) {
    canvasCtx.translate(x, y);

    canvasCtx.lineWidth = 2;
    canvasCtx.strokeStyle = colour;
    canvasCtx.beginPath();

    var sliceWidth = width * 1.0 / bufferLength;
    var x = 0;

    var curVol = 0;

    for (var i = 0; i < bufferLength; i++) {
        var v = dataArray[i] * 200;
        var y = v + height / 2;

        if (i === 0) {
            canvasCtx.moveTo(x, y);
        } else {
            canvasCtx.lineTo(x, y);
        }

        x += sliceWidth;


        curVol += dataArray[i] * dataArray[i];
    }

    curVol /= bufferLength;
    curVol = Math.sqrt(curVol);

    smoothedVol *= 0.80;
    smoothedVol += 0.20 * curVol;

    canvasCtx.lineTo(canvas.width, canvas.height / 2);
    canvasCtx.stroke();

    canvasCtx.setTransform(1, 0, 0, 1, 0, 0);
}

function draw() {
    drawVisual = requestAnimationFrame(draw);

    analyser.getFloatTimeDomainData(dataArray);
    analyser2.getFloatTimeDomainData(dataArray2);

    canvasCtx.fillStyle = 'rgb(100%, 100%, 100%)';
    canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);


    drawVisualizer(0, 0, WIDTH, HEIGHT/2, "red", dataArray);
    drawVisualizer(0, HEIGHT/2, WIDTH, HEIGHT/2, "orange", dataArray2);


    var lcd_tux = document.getElementById('lcd_tux');

    canvasCtx.drawImage(lcd_tux, 0, 0);
    canvasCtx.globalCompositeOperation = "saturation";
    console.log(smoothedVol);
    canvasCtx.fillStyle = "hsl(0," + mapRange([0.01, 0.1], [0, 100], smoothedVol) + "%,50%)";  // saturation at 100%
    canvasCtx.fillRect(0,0,lcd_tux.width,lcd_tux.height);  // apply the comp filter
    canvasCtx.globalCompositeOperation = "source-over";  // restore default comp
};

draw();
    </script>
</body>
